<template>
    <div class="pro-promotion" ref="containerRef">
        <div id="divide-title0-0" floor="1F-01" style="height:auto" request-url="api/api.php?floor=1F-01">
            <div class="">
                <div class="divide-title">
                    <div class="title-a">1F-01 量器</div>
                    <span class="title-b">
                        <label>
                            <a target='_blank'
                                href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1105&gloabSearchVo.rootId=1000'>
                                烧杯</a></label>
                        <label>
                            <a target='_blank'
                                href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1108&gloabSearchVo.rootId=1000'>
                                量筒</a></label>
                        <label>
                            <a target='_blank'
                                href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1101&gloabSearchVo.rootId=1000'>
                                三角烧瓶/锥形瓶</a></label>
                        <label>
                            <a target='_blank'
                                href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1107&gloabSearchVo.rootId=1000'>
                                量杯</a></label>
                        <label>
                            <a target='_blank'
                                href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1104&gloabSearchVo.rootId=1000'>
                                容量瓶</a></label>
                        <label>
                            <a target='_blank'
                                href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1106&gloabSearchVo.rootId=1000'>
                                胖肚移液管</a></label>
                    </span>
                    <div class="clearboth"></div>
                    <div class="line"></div>
                </div>
                <ul>
                    <li>
                        <a target='_blank'
                            href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1105&gloabSearchVo.rootId=1000'>
                            <img src='/upload/images/catalogImg/1575357035071.jpg'
                                ondragstart="window.event.returnValue=false" onerror='nofind();'
                                oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
                            <div class="divide-cbname-icon">
                            </div>
                            <div class="divide-cbname-box">
                                <div class="divide-cbname-f">
                                    <div class="divide-cbname">烧杯</div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a target='_blank'
                            href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1108&gloabSearchVo.rootId=1000'>
                            <img src='/upload/images/catalogImg/1575357109488.jpg'
                                ondragstart="window.event.returnValue=false" onerror='nofind();'
                                oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
                            <div class="divide-cbname-icon">
                            </div>
                            <div class="divide-cbname-box">
                                <div class="divide-cbname-f">
                                    <div class="divide-cbname">量筒</div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a target='_blank'
                            href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1101&gloabSearchVo.rootId=1000'>
                            <img src='/upload/images/catalogImg/1575356941590.jpg'
                                ondragstart="window.event.returnValue=false" onerror='nofind();'
                                oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
                            <div class="divide-cbname-icon">
                            </div>
                            <div class="divide-cbname-box">
                                <div class="divide-cbname-f">
                                    <div class="divide-cbname">三角烧瓶/锥形瓶</div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a target='_blank'
                            href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1107&gloabSearchVo.rootId=1000'>
                            <img src='/upload/images/catalogImg/1575357078030.jpg'
                                ondragstart="window.event.returnValue=false" onerror='nofind();'
                                oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
                            <div class="divide-cbname-icon">
                            </div>
                            <div class="divide-cbname-box">
                                <div class="divide-cbname-f">
                                    <div class="divide-cbname">量杯</div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a target='_blank'
                            href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1104&gloabSearchVo.rootId=1000'>
                            <img src='/upload/images/catalogImg/1575357014959.jpg'
                                ondragstart="window.event.returnValue=false" onerror='nofind();'
                                oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
                            <div class="divide-cbname-icon">
                            </div>
                            <div class="divide-cbname-box">
                                <div class="divide-cbname-f">
                                    <div class="divide-cbname">容量瓶</div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a target='_blank'
                            href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1106&gloabSearchVo.rootId=1000'>
                            <img src='/upload/images/catalogImg/1575357058309.jpg'
                                ondragstart="window.event.returnValue=false" onerror='nofind();'
                                oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
                            <div class="divide-cbname-icon">
                            </div>
                            <div class="divide-cbname-box">
                                <div class="divide-cbname-f">
                                    <div class="divide-cbname">胖肚移液管</div>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <div class="clearboth"></div>
            </div>
        </div>
        <div id="divide-title0-1" floor="1F-02" class=" vue-lazy loading " style="height:300px">
        </div>
        <div id="divide-title0-2" floor="1F-03" class=" vue-lazy loading" style="height:300px">
        </div>
        <div id="divide-title1-0" floor="2F-01" class=" vue-lazy loading" style="height:300px">
        </div>
        <div id="divide-title1-1" floor="2F-02" class=" vue-lazy loading" style="height:300px">
        </div>
        <div id="divide-title1-2" floor="2F-03" class=" vue-lazy loading" style="height:300px">
        </div>
        <div id="divide-title2-0" floor="3F-01" class=" vue-lazy loading" style="height:300px"
            request-url="api/api.php?floor=3F-01">
        </div>
        <div id="divide-title2-1" floor="3F-02" class=" vue-lazy loading" style="height:300px">
        </div>
        <div id="divide-title2-2" floor="3F-03" class=" vue-lazy loading" style="height:300px">
        </div>
        <div id="divide-title3-0" floor="4F-01" class=" vue-lazy loading" style="height:300px">
        </div>
        <div id="divide-title3-1" floor="4F-02" class=" vue-lazy loading" style="height:300px">
        </div>
        <div id="divide-title3-2" floor="4F-03" class=" vue-lazy loading" style="height:300px">
        </div>
    </div>
</template>

<script lang="ts" setup>
import { onMounted, onBeforeUnmount, ref } from 'vue'

const containerRef = ref(null)
let observer: IntersectionObserver | null = null

const makeSectionHtml = (floorLabel: string) => `
  <div class="">
    <div class="divide-title">
      <div class="title-a">${floorLabel} 量器</div>
      <span class="title-b">
        <label>
          <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1105&gloabSearchVo.rootId=1000'>
            烧杯</a></label>
        <label>
          <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1108&gloabSearchVo.rootId=1000'>
            量筒</a></label>
        <label>
          <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1101&gloabSearchVo.rootId=1000'>
            三角烧瓶/锥形瓶</a></label>
        <label>
          <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1107&gloabSearchVo.rootId=1000'>
            量杯</a></label>
        <label>
          <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1104&gloabSearchVo.rootId=1000'>
            容量瓶</a></label>
        <label>
          <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1106&gloabSearchVo.rootId=1000'>
            胖肚移液管</a></label>
      </span>
      <div class="clearboth"></div>
      <div class="line"></div>
    </div>
    <ul>
      <li>
        <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1105&gloabSearchVo.rootId=1000'>
          <img src='/upload/images/catalogImg/1575357035071.jpg'
               ondragstart="window.event.returnValue=false" onerror='nofind();'
               oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
          <div class="divide-cbname-icon"></div>
          <div class="divide-cbname-box">
            <div class="divide-cbname-f">
              <div class="divide-cbname">烧杯</div>
            </div>
          </div>
        </a>
      </li>
      <li>
        <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1108&gloabSearchVo.rootId=1000'>
          <img src='/upload/images/catalogImg/1575357109488.jpg'
               ondragstart="window.event.returnValue=false" onerror='nofind();'
               oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
          <div class="divide-cbname-icon"></div>
          <div class="divide-cbname-box">
            <div class="divide-cbname-f">
              <div class="divide-cbname">量筒</div>
            </div>
          </div>
        </a>
      </li>
      <li>
        <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1101&gloabSearchVo.rootId=1000'>
          <img src='/upload/images/catalogImg/1575356941590.jpg'
               ondragstart="window.event.returnValue=false" onerror='nofind();'
               oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
          <div class="divide-cbname-icon"></div>
          <div class="divide-cbname-box">
            <div class="divide-cbname-f">
              <div class="divide-cbname">三角烧瓶/锥形瓶</div>
            </div>
          </div>
        </a>
      </li>
      <li>
        <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1107&gloabSearchVo.rootId=1000'>
          <img src='/upload/images/catalogImg/1575357078030.jpg'
               ondragstart="window.event.returnValue=false" onerror='nofind();'
               oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
          <div class="divide-cbname-icon"></div>
          <div class="divide-cbname-box">
            <div class="divide-cbname-f">
              <div class="divide-cbname">量杯</div>
            </div>
          </div>
        </a>
      </li>
      <li>
        <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1104&gloabSearchVo.rootId=1000'>
          <img src='/upload/images/catalogImg/1575357014959.jpg'
               ondragstart="window.event.returnValue=false" onerror='nofind();'
               oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
          <div class="divide-cbname-icon"></div>
          <div class="divide-cbname-box">
            <div class="divide-cbname-f">
              <div class="divide-cbname">容量瓶</div>
            </div>
          </div>
        </a>
      </li>
      <li>
        <a target='_blank' href='/search/search.htm?gloabSearchVo.segamentId=1100&gloabSearchVo.branchId=1106&gloabSearchVo.rootId=1000'>
          <img src='/upload/images/catalogImg/1575357058309.jpg'
               ondragstart="window.event.returnValue=false" onerror='nofind();'
               oncontextmenu="window.event.returnValue=false" onselectstart="event.returnValue=false">
          <div class="divide-cbname-icon"></div>
          <div class="divide-cbname-box">
            <div class="divide-cbname-f">
              <div class="divide-cbname">胖肚移液管</div>
            </div>
          </div>
        </a>
      </li>
    </ul>
    <div class="clearboth"></div>
  </div>
`;

const startObserve = () => {
  observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.intersectionRatio >= 1) {
        const el = entry.target as HTMLElement
        const floorLabel = el.getAttribute('floor') || ''
        el.innerHTML = makeSectionHtml(floorLabel)
        el.classList.remove('vue-lazy')
          el.classList.remove('loading')

        el.style.height = 'auto'
        observer && observer.unobserve(el)
      }
    })
  }, { threshold: 1 })

  const elements = containerRef.value?.querySelectorAll('.vue-lazy')
  elements && elements.forEach(el => observer!.observe(el))
}

onMounted(() => {
  // 立即启动观察，无需 300px 门槛
  startObserve()
})

onBeforeUnmount(() => {
  if (observer) observer.disconnect()
})
</script>

<style scoped>

.lazy-loader img {
  width: 32px;
  height: 32px;
}
</style>